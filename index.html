<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch Login</title>

</head>
<body>
    <script type="text/javascript" src="js/logincheck.js"></script>
    <h1>Testing initial Github page function</h1>
    <p id="loginresult">Please Login</p>
    <form id="loginForm">
        <div class="container">
            <label for="uname"><b>Name</b></label>
            <input type="text" placeholder="Enter Name" id="uname" required>
        
            <label for="email"><b>Email</b></label>
            <input type="text" placeholder="Enter Email" id="email" required>
        
            <button type="submit">Login</button>
        </div>
    </form>
</body>
</html>
<script>
    async function checkLogin(event) {
        event.preventDefault();
        const uname = document.getElementById('uname').value;
        const email = document.getElementById('email').value;

        const response = await fetch('https://frontend-take-home-service.fetch.com/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name: uname, email: email })
        });
        const result = await response;
        document.getElementById("loginresult").innerHTML = result.status;
        if (result.status == 200) {
            localStorage.setItem("token", result.headers.getSetCookie("fetch-access-token"));
            window.location.href = "searchpage.html";
        } else {
            document.getElementById("loginresult").innerHTML = "Invalid name or email";
        }

    }
    document.getElementById('loginForm').addEventListener('submit', checkLogin);
</script>