<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/searchpanes/2.3.3/css/searchPanes.dataTables.min.css"/>
    <script src="https://cdn.datatables.net/searchpanes/2.3.3/js/dataTables.searchPanes.min.js"></script>
    <script>
        $(document).ready(function() {
            let favoriteDogs = [];
            let searchTable = new DataTable('#searchTable', {
                select: true,
                paging: true,
                searching: true,
                ordering: true,
                info: false,
                autoWidth: false,
                columnDefs: [
                    { targets: 0, orderable: false, render:    
                        function (data){
                            return '<input type="checkbox" id="favCheck" value="' + $('<div/>').text(data).html() + '">';
                        }
                    },
                    { targets: 1, orderable: false }, 
                    { targets: 2, orderable: true },
                    { targets: 3, orderable: true }, 
                    { targets: 4, orderable: true },
                    { targets: 5, orderable: true }  
                ],
            });
            // $("input:checkbox[name=favcheck]:checked").each(function(){
            //     favoriteDogs.push();
            // })
            
        });
    </script>
    <title>Fetch Login</title>

</head>
<body>
    <script type="text/javascript" src="js/logincheck.js"></script>
    <h1>Fetch Search Page</h1>
    <p id="loginresult">Please Login</p>
    <form id="loginForm">
        <div class="container" id="loginbox">
            <label for="uname"><b>Name</b></label>
            <input type="text" placeholder="Enter Name" id="uname" required>
        
            <label for="email"><b>Email</b></label>
            <input type="text" placeholder="Enter Email" id="email" required>
        
            <button type="submit">Login</button>
        </div>
    </form>
    <form id="searchForm">
        <div class="container" id="searchbox">
            <table id="searchTable" class="display">
                <thead>
                    <tr>
                        <th>Favorite</th>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Age</th>
                        <th>Zip Code</th>
                        <th>Breed</th>
                      </tr>
                </thead>
                <tbody>
                    <tr>
                        <td></td>
                        <td>img</td>
                        <td>A Dog</td>
                        <td>99</td>
                        <td>11111</td>
                        <td>Dog</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>img2</td>
                        <td>B Dog</td>
                        <td>97</td>
                        <td>11112</td>
                        <td>Not Dog</td>
                    </tr>
              </tbody>
              <tfoot>
                </tfoot>
            </table>
            <button type="submit" id="addFavBtn">Add to Favorites</button>
            <button type="submit" id="searchBtn">Search</button>
            <div class="pagination" id="pagebar"></div>
        </div>
    </form>
    
    
    <h1>Favorites</h1>  
    <form id="favForm">
        <div class="container" id="favbox">  
            <table id="favTable" class="display">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Age</th>
                        <th>Zip Code</th>
                        <th>Breed</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </form>
    <button type="submit" id="matchBtn">Match Me</button>
    <button type="submit" id="removeBtn">Remove from Favorites</button>

</body>
</html>
<script>
    //import DataTable from 'datatables.net-dt';
    async function checkLogin(event) {
        event.preventDefault();
        const uname = document.getElementById('uname').value;
        const email = document.getElementById('email').value;

        const response = await fetch('https://frontend-take-home-service.fetch.com/auth/login', {
            method: 'POST',
            credentials: 'include',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name: uname, email: email })
        });
        const result = await response;
        if (result.status == 200) {
            document.getElementById("loginForm").style.display = "none";
            document.getElementById("searchForm").style.display = "block";
            document.getElementById("loginresult").innerHTML = "Login Successful!";
        } else {
            document.getElementById("loginresult").innerHTML = "Invalid name or email";
        }
    }
    async function searchDogs() {
        const dogUrl = "https://frontend-take-home-service.fetch.com/dogs/search";
        const response = await fetch(dogUrl, {
            headers: {
                'Content-Type': 'application/json',
                'Cache': 'no-cache'
            },
            method: 'GET',
            credentials: 'include',
        })
        const result = await response;
        if (result.status !== 200) {
            throw new Error("Failed to fetch data");
        }
        return result.json();
    }

    async function getDogData(dogIdArray){
        const dogUrl = "https://frontend-take-home-service.fetch.com/dogs";
        const response = await fetch(dogUrl, {
            headers: {
                'Content-Type': 'application/json',
                'Cache': 'no-cache'
            },
            method: 'POST',
            credentials: 'include',
            body: JSON.stringify(dogIdArray)
        })
        const result = await response;
        if (result.status !== 200) {
            throw new Error("Failed to fetch data");
        }
        return result.json();

    }

    function createRow(dogData){
        const row = document.createElement("tr");
        const keys = Object.keys(dogData);
        for (const key of keys) {
            const cell = document.createElement("td");
            cell.innerHTML = dogData[key];
            row.appendChild(cell);
        }
        return row;
    }

    // function fillTableContent(event) {
    //     event.preventDefault();
    //     const dogArray = searchDogs().resultIds;
    //     const dogData = getDogData(dogArray);
    //     const table = document.getElementById("searchtable");
    //     for (const dog of dogArray) {
    //         table.appendChild(createRow(dog));
    //     }
    // }

    function displayTableContent(curPage, pageSize) {
        event.preventDefault();
        const table = document.getElementById("searchTable");
        const start = (curPage - 1) * pageSize;
        const end = Math.min(start + pageSize, dogData.length);
        const dogArray = searchDogs().resultIds;
        const allDogData = getDogData(dogArray);
        for (let i = start; i < end; i++) {
            table.appendChild(createRow(dogData[i]));
        }
        //updatePagination(curPage, pageSize, dogData.length);
    }

    function updateFavTable(dogDataArray) {
        const favTable = document.getElementById('favTable').getElementsByTagName('tbody')[0];
        favTable.innerHTML = ''; // Clear existing rows
        dogDataArray.forEach(dogData => {
            const row = createRow(dogData);
            favTable.appendChild(row);
        });
    }
    // function updatePagination(curPage, pageSize, totalItems) {
    //     const pagebar = document.getElementById("pagebar");
    //     pagebar.innerHTML = ""; // Clear previous pagination
    //     const totalPages = Math.ceil(totalItems / pageSize);
    //     for (let i = 1; i <= totalPages; i++) {
    //         const button = document.createElement("button");
    //         button.innerHTML = i;
    //         button.onclick = function() {
    //             displayTableContent(i, pageSize, dogData);
    //         };
    //         if (i === curPage) {
    //             button.disabled = true; // Disable the current page button
    //         }
    //         pagebar.appendChild(button);
    //     }
    // }
    document.getElementById('loginForm').addEventListener('submit', checkLogin);
    document.getElementById('searchForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const button = event.submitter.id;

        if (button === "addFavBtn") {
            const selectedDogs = [];
            $('#searchTable tbody input[type="checkbox"]:checked').each(function() {
                const row = $(this).closest('tr');
                const name = row.find('td:eq(2)').text();
                selectedDogs.push(row);
            });
            document.getElementById('loginresult').innerHTML = selectedDogs.join(', ');
        }
    });
        
        // if (button === "addFavBtn") {
        //     const selectedDogs = [];
        //     const currentRow = 
        //     searchTable.rows().every( function ( rowIdx, tableLoop, rowLoop ) {
        //         if (this.row(rowIdx).column(0).checkboxes.selected){
        //             selectedDogs.push(this.row(rowIdx).column(3).data());
        //         }
                
        //         // ... do something with data(), or this.node(), etc
        //     } );
            
            // $("input:checkbox[id=favCheck]:checked").each(function() {
            //     selectedDogs.push($(this).val());
            //     document.getElementById('loginresult').innerHTML = searchTable.row((this).val()).data("name");
            // });
            // const dognumber = selectedDogs.length;
            // document.getElementById('loginresult').innerHTML = dognumber;
            // getDogData(selectedDogs).then(dogData => {
            //     dogData.forEach(dog => {
            //         favTable.row.add(createRow(dog)).draw();
            //     });
            // });
    //} 
        // else if (button === "searchBtn") {
        //     displayTableContent(1, 10);
        // }
        // });
        
    
    
    //displayContentTable(1, 10, dogData);
</script>